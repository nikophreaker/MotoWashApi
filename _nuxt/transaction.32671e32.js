import{_ as Y}from"./ErrorMessage.vue.830f5050.js";import{f as Z,r as g,s as A,D as ee,O as te,v as u,i as L,G as N,o as y,c as h,M as F,N as O,u as l,a as o,b as r,w as f,d,F as b,t as p,m as w,n as ae}from"./entry.840b05cf.js";import{L as E}from"./main.cc796b43.js";const le=o("h2",{class:"text-2xl font-bold"},"Datatable Transaction",-1),ne=o("hr",{class:"my-2 border dark:border-gray-700"},null,-1),oe={class:"col-span-12 flex justify-start gap-1"},re={class:"col-span-12 flex justify-start gap-1 my-2"},se={key:6,class:"flex gap-2 justify-center"},ie=o("div",{class:"p-2 rounded"},"Sorry, No Data Available",-1),ue=o("hr",{class:"my-2 dark:border-gray-700"},null,-1),de={class:"flex gap-2"},pe=o("div",{class:"w-32"},"Selected Data",-1),ce={class:"flex gap-2"},me=o("div",{class:"w-32"},"Order By",-1),ve={class:"flex gap-2"},fe=o("div",{class:"w-32"},"Order Type",-1),ye={class:"flex gap-2"},he=o("div",{class:"w-32"},"Search",-1),we={class:"font-bold"},De={class:"col-span-12"},ge={class:"col-span-12"},be={class:"col-span-12"},Te={class:"col-span-12"},Se={class:"col-span-12"},Pe={class:"col-span-12"},_e={class:"col-span-12 flex justify-end gap-1"},q="formTransaction",Me=Z({__name:"transaction",setup(Ce){const s=g({column:[{label:"Name",field:"name",width:"400px",sortable:!0},{label:"Product",field:"product",width:"400px",sortable:!0},{label:"Date",field:"date",width:"400px",sortable:!0},{label:"Total",field:"total",width:"400px",sortable:!0},{label:"Payment Method",field:"paymentMethod",width:"400px",sortable:!0},{label:"Payment Status",field:"paymentStatus",width:"400px",sortable:!0},{label:"Action",field:"action",width:"400px",sortable:!1}],data:[],limit:5,offset:0,search:"",selected:[],sortBy:"name",sortType:"asc",setting:{checkbox:!0,limitOption:[{label:"5",value:5},{label:"10",value:10},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200}]}});var D=g(!1);const v=A({startDate:null,endDate:null}),R=t=>{t()};function j(t,e,i){t[i]=t[e],delete t[e]}async function C(){var t=new URLSearchParams;t.append("startDate",v.startDate?v.startDate:""),t.append("endDate",v.endDate?v.endDate:""),t.append("limit",s.value.limit.toString()),t.append("skip",s.value.offset.toString()),t.append("query",s.value.search.toString()),await fetch("/api/transaction",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t,redirect:"follow"}).then(e=>{e!=null&&e.json().then(i=>{if(i.error==null){const a=i;a.forEach(m=>j(m,"_id","id")),s.value.data=a}})}).catch(e=>{})}async function H(){if(c.value.clearErrors(),await c.value.validate(),c.value.fail()){T.error({message:c.value.getErrorMessage()}),S.value=!0,setTimeout(()=>{S.value=!1},1e3);return}var t=new URLSearchParams;t.append("userId",n.selectCustomer),t.append("productId",n.multiSelectProduct),t.append("transactionDate",n.inputDate),t.append("totalAmount",n.inputTotal),t.append("paymentMethod",n.inputPaymentMethod),t.append("paymentStatus",n.inputPaymentStatus),$fetch("/api/transaction/transaction",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t,redirect:"follow"}).then(e=>{e!=null&&x(e)}).catch(e=>{x(e)})}async function G(){if(c.value.clearErrors(),await c.value.validate(),c.value.fail()){T.error({message:c.value.getErrorMessage()}),S.value=!0,setTimeout(()=>{S.value=!1},1e3);return}var t=new URLSearchParams;t.append("id",P.value.id),t.append("userId",n.selectCustomer),t.append("productId",n.multiSelectProduct),t.append("transactionDate",n.inputDate),t.append("totalAmount",n.inputTotal),t.append("paymentMethod",n.inputPaymentMethod),t.append("paymentStatus",n.inputPaymentStatus),$fetch("/api/transaction/transaction",{method:"PATCH",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t,redirect:"follow"}).then(e=>{e!=null&&x(e)}).catch(e=>{x(e)})}function z(t){var e=new URLSearchParams;return e.append("id",t),$fetch("/api/transaction/transaction",{method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e,redirect:"follow"}).then(a=>a!=null?(C(),!0):!1).catch(a=>!1)}ee(async()=>{C()}),te(async()=>{D.value&&(B(),$())});var V=g([]),M=g([]);async function B(){await fetch("/api/customer",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow"}).then(t=>{t!=null&&(V.value=[],t.json().then(e=>{e.error==null&&e.forEach(i=>{V.value.push({label:i.name,value:i._id})})}))}).catch(t=>{})}async function $(){await fetch("/api/product",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow"}).then(t=>{t!=null&&(M.value=[],t.json().then(e=>{e.error==null&&e.forEach(i=>{M.value.push({label:i.name,value:i._id})})}))}).catch(t=>{})}const J=u.useForm(),K=u.useDialog(),T=u.useToast();async function Q(t){if(t!=null){if(!await K.fire({title:`Delete ${t.name}`,description:`Are you sure to delete ${t.name} ?`,icon:"alert-triangle"}))return;z(t.id).then(i=>{i?T.success({message:`Success Delete ${t.name}`}):T.error({message:`Failed Delete ${t.name}`})})}}const S=g(!1),W=L(()=>J.getForm(q)),c=L(()=>W.value.validator);async function x(t){t.error!=null?T.error({message:t.message}):(I(void 0),k(),C(),U())}const n=A({selectCustomer:null,multiSelectProduct:null,inputDate:null,inputTotal:null,inputPaymentMethod:null,inputPaymentStatus:null}),X={selectCustomer:["required"],multiSelectProduct:["required"],inputDate:["required","string"],inputTotal:["required"],inputPaymentMethod:["required","string"],inputPaymentStatus:["required","string"]};function U(){n.selectCustomer=null,n.multiSelectProduct=null,n.inputDate=null,n.inputTotal=null,n.inputPaymentMethod=null,n.inputPaymentStatus=null,c.value.clearErrors()}var P=g();function I(t){P.value=t,t!=null&&(n.selectCustomer=t.detail_user[0]._id,n.multiSelectProduct=t.detail_product.map(e=>e._id),n.inputDate=t.transactionDate,n.inputTotal=t.totalAmount,n.inputPaymentMethod=t.paymentMethod,n.inputPaymentStatus=t.paymentStatus)}function k(){c.value.clearErrors(),D.value=!D.value,D.value&&(B(),$())}return N(n,t=>{t.inputDate!=null&&t.inputDate!=null&&(n.inputDate=t.inputDate.toString())}),N(v,t=>{C()}),(t,e)=>{const i=Y;return y(),h("div",null,[le,ne,F(o("div",null,[o("div",oe,[r(l(u.TwButton),{variant:"primary",icon:"file-plus",class:"border border-gray-900 my-2",onClick:e[0]||(e[0]=a=>k())},{default:f(()=>[d(" Add Data ")]),_:1})]),o("div",re,[r(l(E),{class:"dp",label:"Start Date",name:"startDate",modelValue:l(v).startDate,"onUpdate:modelValue":e[1]||(e[1]=a=>l(v).startDate=a),placeholder:"Input Start Date",type:"text"},null,8,["modelValue"]),r(l(E),{class:"dp",label:"End Date",name:"endDate",modelValue:l(v).endDate,"onUpdate:modelValue":e[2]||(e[2]=a=>l(v).endDate=a),placeholder:"Input End Date",type:"text"},null,8,["modelValue"])]),r(l(u.TwDatatableClient),{class:"!dark:text-gray-200",search:s.value.search,"onUpdate:search":e[3]||(e[3]=a=>s.value.search=a),limit:s.value.limit,"onUpdate:limit":e[4]||(e[4]=a=>s.value.limit=a),selected:s.value.selected,"onUpdate:selected":e[5]||(e[5]=a=>s.value.selected=a),"sort-by":s.value.sortBy,"onUpdate:sortBy":e[6]||(e[6]=a=>s.value.sortBy=a),"sort-type":s.value.sortType,"onUpdate:sortType":e[7]||(e[7]=a=>s.value.sortType=a),column:s.value.column,data:s.value.data,setting:s.value.setting,"onDatatable:columnHook":R},{row:f(({column:a,data:m})=>[a.field==="name"?(y(),h(b,{key:0},[d(p(m.detail_user.map(_=>_.name).toString()),1)],64)):w("",!0),a.field==="product"?(y(),h(b,{key:1},[d(p(m.detail_product.map(_=>_.name).toString()),1)],64)):w("",!0),a.field==="date"?(y(),h(b,{key:2},[d(p(new Date(m.transactionDate).toLocaleDateString("id-ID",{hour12:!1,weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})),1)],64)):w("",!0),a.field==="total"?(y(),h(b,{key:3},[d(p(m.totalAmount),1)],64)):w("",!0),a.field==="paymentMethod"?(y(),h(b,{key:4},[d(p(m.paymentMethod),1)],64)):w("",!0),a.field==="paymentStatus"?(y(),h(b,{key:5},[d(p(m.paymentStatus),1)],64)):w("",!0),a.field==="action"?(y(),h("div",se,[r(l(u.TwButton),{variant:"primary",class:"border border-gray-900",onClick:_=>{k(),I(m)}},{default:f(()=>[d(" Edit ")]),_:2},1032,["onClick"]),r(l(u.TwButton),{variant:"danger",onClick:_=>Q(m)},{default:f(()=>[d(" Delete ")]),_:2},1032,["onClick"])])):w("",!0)]),empty:f(()=>[ie]),_:1},8,["search","limit","selected","sort-by","sort-type","column","data","setting"]),ue,o("div",null,[o("div",de,[pe,o("div",null,": "+p(s.value.selected),1)]),o("div",ce,[me,o("div",null,": "+p(s.value.sortBy),1)]),o("div",ve,[fe,o("div",null,": "+p(s.value.sortType),1)]),o("div",ye,[he,o("div",null,": "+p(s.value.search),1)])])],512),[[O,!l(D)]]),F(o("div",null,[o("h1",we,p(l(P)!=null?`Update Data ${l(P).name}`:"Tambah Data"),1),r(l(u.TwForm),{name:q,class:ae(["grid grid-cols-12 gap-2 bg-white dark:bg-gray-900 dark:border dark:border-gray-700 rounded-lg p-2 shadow",{"tw-shake":S.value}]),rules:X,onSubmit:e[17]||(e[17]=a=>l(P)!=null?G():H()),"custom-field-name":{inputDate:"Input",inputTotal:"Input",inputPaymentMethod:"Input",inputPaymentStatus:"Input"}},{default:f(()=>[o("div",De,[r(l(u.TwSelect),{label:"Name Customer",name:"selectCustomer",modelValue:l(n).selectCustomer,"onUpdate:modelValue":e[8]||(e[8]=a=>l(n).selectCustomer=a),items:l(V),placeholder:"Choose Customer"},null,8,["modelValue","items"]),r(i,{name:"selectCustomer"})]),o("div",ge,[r(l(u.TwMultiSelect),{label:"Select Product",name:"multiSelectProduct",modelValue:l(n).multiSelectProduct,"onUpdate:modelValue":e[9]||(e[9]=a=>l(n).multiSelectProduct=a),items:l(M),placeholder:"Choose Product"},null,8,["modelValue","items"]),r(i,{name:"multiSelectProduct"})]),o("div",be,[r(l(u.TwInput),{label:"Transaction Date",name:"inputDate",modelValue:l(n).inputDate,"onUpdate:modelValue":e[10]||(e[10]=a=>l(n).inputDate=a),placeholder:"Transaction Date",type:"text",disabled:""},null,8,["modelValue"]),r(l(E),{class:"dp",label:"Transaction Date",name:"inputDate",modelValue:l(n).inputDate,"onUpdate:modelValue":e[11]||(e[11]=a=>l(n).inputDate=a),placeholder:"Input Date",type:"text"},null,8,["modelValue"]),r(i,{name:"inputDate"})]),o("div",Te,[r(l(u.TwInput),{label:"Total Amount",name:"inputTotal",modelValue:l(n).inputTotal,"onUpdate:modelValue":e[12]||(e[12]=a=>l(n).inputTotal=a),placeholder:"Input Total",type:"text"},null,8,["modelValue"]),r(i,{name:"inputTotal"})]),o("div",Se,[r(l(u.TwInput),{label:"Payment Method",name:"inputPaymentMethod",modelValue:l(n).inputPaymentMethod,"onUpdate:modelValue":e[13]||(e[13]=a=>l(n).inputPaymentMethod=a),placeholder:"Input Method",type:"text"},null,8,["modelValue"]),r(i,{name:"inputPaymentMethod"})]),o("div",Pe,[r(l(u.TwInput),{label:"Payment Status",name:"inputPaymentStatus",modelValue:l(n).inputPaymentStatus,"onUpdate:modelValue":e[14]||(e[14]=a=>l(n).inputPaymentStatus=a),placeholder:"Input Status",type:"text"},null,8,["modelValue"]),r(i,{name:"inputPaymentStatus"})]),o("div",_e,[r(l(u.TwButton),{variant:"primary",type:"button",class:"border border-gray-900",onClick:e[15]||(e[15]=a=>{U(),k(),I(void 0)})},{default:f(()=>[d(" Close ")]),_:1}),r(l(u.TwButton),{ripple:"",variant:"secondary",type:"button",class:"dark:text-gray-200 dark:!border-gray-800 dark:border",onClick:e[16]||(e[16]=a=>U())},{default:f(()=>[d(" Reset ")]),_:1}),r(l(u.TwButton),{variant:"primary"},{default:f(()=>[d(" Submit ")]),_:1})])]),_:1},8,["class"])],512),[[O,l(D)]])])}}});export{Me as default};
